{% extends "base.html" %}
{% load static %}

{% block content %}

<div class="kanban-board">
    <div class="kanban-column">
        <h2>Pending</h2>
        <div class="post-it-container" id="pending-tasks">
            {% for task in pending_tasks %}
            <div class="post-it" data-task-id="{{ task.id }}">
                <p contenteditable="true" class="editable-task">{{ task.title }}</p>
            </div>
            {% endfor %}
        </div>
        <button class="add-task-btn" data-status="pending">Add Task</button>
    </div>
    <div class="kanban-column">
        <h2>In Progress</h2>
        <div class="post-it-container" id="in-progress-tasks">
            {% for task in in_progress_tasks %}
            <div class="post-it" data-task-id="{{ task.id }}">
                <p contenteditable="true" class="editable-task">{{ task.title }}</p>
            </div>
            {% endfor %}
        </div>
        <button class="add-task-btn" data-status="in_progress">Add Task</button>
    </div>
    <div class="kanban-column">
        <h2>Completed</h2>
        <div class="post-it-container" id="completed-tasks">
            {% for task in completed_tasks %}
            <div class="post-it" data-task></div>
            <p contenteditable="true" class="editable-task">{{ task.title }}</p>
        </div>
        {% endfor %}
    </div>
    <button class="add-task-btn" data-status="completed">Add Task</button>
</div>
</div>

        <style>
            .kanban-board {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        .kanban-column {
            flex: 1;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .kanban-column h2 {
            text-align: center;
            margin-bottom: 10px;
        }
        .post-it-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .post-it {
            background-color: #ffeb3b;
            padding: 10px;
            border: 1px solid #fbc02d;
            border-radius: 5px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
            font-family: 'Comic Sans MS', cursive, sans-serif;
            color: #333;
        }
        .post-it p {
            margin: 0;
            word-wrap: break-word;
        }
        .add-task-btn {
            margin-top: 10px;
            padding: 5px 10px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;g
        }
        .add-task-btn:hover {
            background-color: #45a049;
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Handle adding new tasks
            document.querySelectorAll('.add-task-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const status = button.getAttribute('data-status');
                    const container = document.getElementById(`${status}-tasks`);

                    // Create a new post-it element
                    const newPostIt = document.createElement('div');
                    newPostIt.classList.add('post-it');
                    newPostIt.setAttribute('contenteditable', 'true');
                    newPostIt.innerHTML = '<p contenteditable="true" class="editable-task">New Task</p>';
                    container.appendChild(newPostIt);

                    // Save the new task to the server
                    fetch('/add-task/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}',
                        },
                        body: JSON.stringify({
                            title: 'New Task',
                            status: status,
                        }),
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Update the task ID for the new task
                            newPostIt.setAttribute('data-task-id', data.task_id);
                        } else {
                            alert('Failed to add task.');
                            newPostIt.remove(); // Remove the task if saving fails
                        }
                    });
                });
            });
        });
    </script>
    {% endblock content %}